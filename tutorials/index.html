
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../training/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.29">
    
    
      
        <title>Tutorial - Torch2Chip</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.76a95c52.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="Tutorial - Torch2Chip" >
      
        <meta  property="og:description"  content="None" >
      
        <meta  property="og:image"  content="./assets/images/social/tutorials.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="None" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="Tutorial - Torch2Chip" >
      
        <meta  name="twitter:description"  content="None" >
      
        <meta  name="twitter:image"  content="./assets/images/social/tutorials.png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tutorial" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Torch2Chip" class="md-header__button md-logo" aria-label="Torch2Chip" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Torch2Chip
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Tutorial
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../basic%20modules/" class="md-tabs__link">
        
  
    
  
  Basic Modules

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../compression/" class="md-tabs__link">
        
  
    
  
  DNN Compression

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../export/" class="md-tabs__link">
        
  
    
  
  T2C Core Modules

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../pretrained/" class="md-tabs__link">
        
  
    
  
  Pre-trained Model

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../training/" class="md-tabs__link">
        
  
    
  
  Training

      </a>
    </li>
  

      
        
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
    
  
  Tutorial

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Torch2Chip" class="md-nav__button md-logo" aria-label="Torch2Chip" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Torch2Chip
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../basic%20modules/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Basic Modules
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../compression/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DNN Compression
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../export/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T2C Core Modules
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../pretrained/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pre-trained Model
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../training/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Training
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Tutorial
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Tutorial
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#set-up-the-torch2chip-environment" class="md-nav__link">
    <span class="md-ellipsis">
      Set up the Torch2Chip environment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compress-your-model" class="md-nav__link">
    <span class="md-ellipsis">
      Compress your model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#convert-the-fake-quantized-model-to-torch2chip-model" class="md-nav__link">
    <span class="md-ellipsis">
      Convert the Fake-Quantized model to Torch2Chip model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reload-your-torch2chip-model-back-for-verification" class="md-nav__link">
    <span class="md-ellipsis">
      Reload your Torch2Chip model back for verification
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="tutorial">Tutorial</h1>
<h2 id="set-up-the-torch2chip-environment">Set up the Torch2Chip environment</h2>
<p>To start, create the compatible environment based on the conda environment file <code>t2c.yml</code> :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>conda<span class="w"> </span>env<span class="w"> </span>create<span class="w"> </span>-f<span class="w"> </span>t2c.yml
</code></pre></div>
<p>Specifically, the basic dependencies of torch2chip are:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>python<span class="w"> </span><span class="m">3</span>.9.19
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="nv">torch</span><span class="o">==</span><span class="m">2</span>.3.0
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="nv">torchaudio</span><span class="o">==</span><span class="m">2</span>.3.0
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="nv">torchvision</span><span class="o">==</span><span class="m">0</span>.18.0
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>huggingface-hub<span class="o">==</span><span class="m">0</span>.23.1
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="nv">timm</span><span class="o">==</span><span class="m">1</span>.0.3
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="nv">fxpmath</span><span class="o">==</span><span class="m">0</span>.4.9
</code></pre></div>
<p>Activate your newly installed conda environment and start using Torch2Chip (see below)</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1"># To activate this environment, use</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="c1">#</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="c1">#     $ conda activate t2c</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="c1">#</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="c1"># To deactivate an active environment, use</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="c1">#</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="c1">#     $ conda deactivate</span>
</code></pre></div>
<h2 id="compress-your-model">Compress your model</h2>
<p>In Torch2Chip, we provide various example running scripts for different vision models, starting from the basic CNN (e.g., ResNet) to vision transformers (e.g., ViT). Given the needs of quickly compressing a pre-trained model, we employ post-training quantization (PTQ) as the major compression scheme for all the pre-trained FP32 model. </p>
<p>List of examples are located here (<a href="https://github.com/SeoLabCornell/torch2chip/tree/main/script/imagenet"><strong>link</strong></a>).</p>
<p>Currently, Torch2Chip have provided all different kinds of combinations between quantization methods and pre-trained models. </p>
<p><strong>Example:</strong> Compressing a ViT-Small model on ImageNet with PTQ: </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$DIRECTORY</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">    </span>mkdir<span class="w"> </span>./save
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="k">fi</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="nb">export</span><span class="w"> </span><span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="m">0</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="nv">model</span><span class="o">=</span>vit_small
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="nv">epochs</span><span class="o">=</span><span class="m">1</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="nv">batch_size</span><span class="o">=</span><span class="m">100</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="nv">lr</span><span class="o">=</span>1e-4
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="nv">loss</span><span class="o">=</span>cross_entropy
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="nv">weight_decay</span><span class="o">=</span>1e-4
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="nv">dataset</span><span class="o">=</span><span class="s2">&quot;imagenet&quot;</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="nv">log_file</span><span class="o">=</span><span class="s2">&quot;training.log&quot;</span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="nv">wbit</span><span class="o">=</span><span class="m">8</span>
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="nv">abit</span><span class="o">=</span><span class="m">8</span>
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a><span class="nv">xqtype</span><span class="o">=</span><span class="s2">&quot;lsq_token&quot;</span>
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a><span class="nv">wqtype</span><span class="o">=</span><span class="s2">&quot;minmax_channel&quot;</span>
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a><span class="nv">num_samples</span><span class="o">=</span><span class="m">500</span>
<a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a><span class="nv">ttype</span><span class="o">=</span>qattn
<a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a><span class="nv">layer_train</span><span class="o">=</span>True
<a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a>
<a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a><span class="nv">save_path</span><span class="o">=</span><span class="s2">&quot;./save/</span><span class="si">${</span><span class="nv">dataset</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">model</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">xqtype</span><span class="si">}</span><span class="s2">_</span><span class="si">${</span><span class="nv">wqtype</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">model</span><span class="si">}</span><span class="s2">_w</span><span class="si">${</span><span class="nv">wbit</span><span class="si">}</span><span class="s2">_a</span><span class="si">${</span><span class="nv">abit</span><span class="si">}</span><span class="s2">_lr</span><span class="si">${</span><span class="nv">lr</span><span class="si">}</span><span class="s2">_batch</span><span class="si">${</span><span class="nv">batch_size</span><span class="si">}</span><span class="s2">_</span><span class="si">${</span><span class="nv">loss</span><span class="si">}</span><span class="s2">loss_all/&quot;</span>
<a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a>
<a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a>python3<span class="w"> </span>-W<span class="w"> </span>ignore<span class="w"> </span>./imagenet/vit.py<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a><span class="w">    </span>--save_path<span class="w"> </span><span class="si">${</span><span class="nv">save_path</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a><span class="w">    </span>--model<span class="w"> </span><span class="si">${</span><span class="nv">model</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-3-29" name="__codelineno-3-29" href="#__codelineno-3-29"></a><span class="w">    </span>--epochs<span class="w"> </span><span class="si">${</span><span class="nv">epochs</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-3-30" name="__codelineno-3-30" href="#__codelineno-3-30"></a><span class="w">    </span>--log_file<span class="w"> </span><span class="si">${</span><span class="nv">log_file</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-3-31" name="__codelineno-3-31" href="#__codelineno-3-31"></a><span class="w">    </span>--lr<span class="w"> </span><span class="si">${</span><span class="nv">lr</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-3-32" name="__codelineno-3-32" href="#__codelineno-3-32"></a><span class="w">    </span>--weight-decay<span class="w"> </span><span class="si">${</span><span class="nv">weight_decay</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-3-33" name="__codelineno-3-33" href="#__codelineno-3-33"></a><span class="w">    </span>--batch_size<span class="w"> </span><span class="si">${</span><span class="nv">batch_size</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-3-34" name="__codelineno-3-34" href="#__codelineno-3-34"></a><span class="w">    </span>--loss_type<span class="w"> </span><span class="si">${</span><span class="nv">loss</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-3-35" name="__codelineno-3-35" href="#__codelineno-3-35"></a><span class="w">    </span>--dataset<span class="w"> </span><span class="si">${</span><span class="nv">dataset</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-3-36" name="__codelineno-3-36" href="#__codelineno-3-36"></a><span class="w">    </span>--mixed_prec<span class="w"> </span>True<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-3-37" name="__codelineno-3-37" href="#__codelineno-3-37"></a><span class="w">    </span>--optimizer<span class="w"> </span>adam<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-3-38" name="__codelineno-3-38" href="#__codelineno-3-38"></a><span class="w">    </span>--trainer<span class="w"> </span><span class="si">${</span><span class="nv">ttype</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-3-39" name="__codelineno-3-39" href="#__codelineno-3-39"></a><span class="w">    </span>--wqtype<span class="w"> </span><span class="si">${</span><span class="nv">wqtype</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-3-40" name="__codelineno-3-40" href="#__codelineno-3-40"></a><span class="w">    </span>--xqtype<span class="w"> </span><span class="si">${</span><span class="nv">xqtype</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-3-41" name="__codelineno-3-41" href="#__codelineno-3-41"></a><span class="w">    </span>--wbit<span class="w"> </span><span class="si">${</span><span class="nv">wbit</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-3-42" name="__codelineno-3-42" href="#__codelineno-3-42"></a><span class="w">    </span>--abit<span class="w"> </span><span class="si">${</span><span class="nv">abit</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-3-43" name="__codelineno-3-43" href="#__codelineno-3-43"></a><span class="w">    </span>--num_samples<span class="w"> </span><span class="si">${</span><span class="nv">num_samples</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-3-44" name="__codelineno-3-44" href="#__codelineno-3-44"></a><span class="w">    </span>--fine_tune<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-3-45" name="__codelineno-3-45" href="#__codelineno-3-45"></a><span class="w">    </span>--train_dir<span class="w"> </span><span class="s2">&quot;/share/seo/imagenet/train/&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-3-46" name="__codelineno-3-46" href="#__codelineno-3-46"></a><span class="w">    </span>--val_dir<span class="w"> </span><span class="s2">&quot;/share/seo/imagenet/val/&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-3-47" name="__codelineno-3-47" href="#__codelineno-3-47"></a><span class="w">    </span>--layer_trainer<span class="w"> </span><span class="si">${</span><span class="nv">layer_train</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
</code></pre></div>
<p><strong>Arguments:</strong></p>
<p><code>model</code>: Model architecture. </p>
<ul>
<li>
<p><code>vit_tiny</code>: <code>vit_tiny_patch16_224</code> pretrained by timm.</p>
</li>
<li>
<p><code>vit_small</code>: <code>vit_base_patch16_224</code> pretrained by timm.</p>
</li>
<li>
<p><code>vit_base</code>: <code>vit_base_patch16_224</code> pretrained by timm.</p>
</li>
<li>
<p><code>swin_tiny_patch4_window7_224</code>: <code>swin_tiny_patch4_window7_224</code> pretrained by timm.</p>
</li>
<li>
<p><code>swin_base_patch4_window7_224</code>: <code>swin_base_patch4_window7_224</code> pretrained by timm.</p>
</li>
</ul>
<p><code>xqtype</code>: Activation quantizer type</p>
<ul>
<li><code>lsq</code>: Learned Step Size Quantization (LSQ) , Granularity: Tensor-wise.</li>
</ul>
<p><code>wqtype</code>: Weight quantizer type</p>
<ul>
<li><code>minmax_channel</code>: Channel-wise MinMax Quantizer. </li>
</ul>
<p><code>save_path</code>: Model saving path.</p>
<ul>
<li>By default, the compressed model will be saved inside the <code>./save/</code> folder under the torch2chip directory. </li>
</ul>
<p><code>epochs</code>: Number of epochs for PTQ. </p>
<ul>
<li>For fast compression process, we only run one time for each PTQ. </li>
</ul>
<p><code>log_file</code>: Output log file that shows accuracy and model architecture. </p>
<p><code>lr</code>: Learning rate of PTQ (if there are trainable parameters in your quantizers).</p>
<p><code>weight-decay</code>: Weight decay and regularization of PTQ (if there are trainable parameters in your quantizers).</p>
<p><code>batch_size</code>: Batch size of PTQ calibration. </p>
<p><code>loss_type</code>: Calibration loss of PTQ. </p>
<p><code>dataset</code>: Dataset / task for the calibration. </p>
<p><code>mixed_prec</code>: Enable mixed precision training. </p>
<p><code>optimizer</code>: Optimizer of PTQ (if there are trainable parameters in your quantizers).</p>
<p><code>trainer</code>: Calibration engine for post-training quantization (Details of different trainers can be found in the <strong>Training</strong> section. </p>
<ul>
<li><code>ptq</code>: Calibrator for CNN.</li>
<li><code>qattn</code>: Calibrator for vision transformers (inherited from <code>ptq</code>). </li>
<li><code>smooth_quant</code>: Calibrator for SmoothQuant (inheirted from <code>qattn</code>).</li>
</ul>
<p><code>num_samples</code>: Total number of calibration samples (default = 500).</p>
<p><code>fine_tune</code>: Flag for fine-tuning and reloading. </p>
<p><code>train_dir</code>: Directory of the training set of your dataset. </p>
<p><code>val_dir</code>: Directory of the validation set of your dataset. </p>
<p><code>layer_trainer</code>: Flag of controlling whether to optimize the trainable quantizer parameter (e.g., for LSQ) or just one shot calibration (e.g., for MinMax quantizer).</p>
<hr />
<p>By executing the script above, torch2chip will start calibrating the model with compression. Please note that, if your model has been pruned by the pruner (link), torch2chip will collectively comrpess the sparse weights into the user-defined precision: <span class="arithmatex">\(W_Q = Quantize(W\times mask)\)</span>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>bash<span class="w"> </span>script/imagenet/vit-ptq-minmax-lsq.sh
</code></pre></div>
<p>After the calibration is completed, the fake-quantized model checkpoint is saved together with the log file:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="nb">cd</span><span class="w"> </span>./save/imagenet/vit_small/lsq_minmax_channel/vit_small_w8_a8_lr1e-4_batch100_cross_entropyloss_all
</code></pre></div>
<h2 id="convert-the-fake-quantized-model-to-torch2chip-model">Convert the Fake-Quantized model to Torch2Chip model</h2>
<p>Now you have a pre-trained fake-quantized model as a starting point. Now we can call T2C to fuse up the module and save all the intermediate input and output results. </p>
<p>In the previous example, we use the learned step size quantization for activation and channel-wise minmax quantization for weights. To fuse the fake-quantized model, we elaborate the example of T2C into <code>t2c.py</code> with the execution script <code>vit-t2c-minmax-lsq.sh</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$DIRECTORY</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">    </span>mkdir<span class="w"> </span>./save
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="k">fi</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="nb">export</span><span class="w"> </span><span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="m">0</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="nv">model</span><span class="o">=</span>vit_small
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="nv">epochs</span><span class="o">=</span><span class="m">200</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="nv">batch_size</span><span class="o">=</span><span class="m">100</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="nv">lr</span><span class="o">=</span><span class="m">0</span>.1
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="nv">loss</span><span class="o">=</span>cross_entropy
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="nv">weight_decay</span><span class="o">=</span><span class="m">0</span>.0005
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="nv">dataset</span><span class="o">=</span><span class="s2">&quot;imagenet&quot;</span>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="nv">log_file</span><span class="o">=</span><span class="s2">&quot;t2c.log&quot;</span>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="nv">wbit</span><span class="o">=</span><span class="m">8</span>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="nv">abit</span><span class="o">=</span><span class="m">8</span>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="nv">xqtype</span><span class="o">=</span><span class="s2">&quot;lsq_token&quot;</span>
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="nv">wqtype</span><span class="o">=</span><span class="s2">&quot;minmax_channel&quot;</span>
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="nv">ttype</span><span class="o">=</span>ptq
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a>
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a><span class="nv">save_path</span><span class="o">=</span><span class="s2">&quot;./save/imagenet/</span><span class="si">${</span><span class="nv">model</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">xqtype</span><span class="si">}</span><span class="s2">_</span><span class="si">${</span><span class="nv">wqtype</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">model</span><span class="si">}</span><span class="s2">_w</span><span class="si">${</span><span class="nv">wbit</span><span class="si">}</span><span class="s2">_a</span><span class="si">${</span><span class="nv">abit</span><span class="si">}</span><span class="s2">_lr1e-4_batch100_cross_entropyloss_all/t2c/&quot;</span>
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a><span class="nv">pre_trained</span><span class="o">=</span><span class="s2">&quot;./save/imagenet/</span><span class="si">${</span><span class="nv">model</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">xqtype</span><span class="si">}</span><span class="s2">_</span><span class="si">${</span><span class="nv">wqtype</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">model</span><span class="si">}</span><span class="s2">_w</span><span class="si">${</span><span class="nv">wbit</span><span class="si">}</span><span class="s2">_a</span><span class="si">${</span><span class="nv">abit</span><span class="si">}</span><span class="s2">_lr1e-4_batch100_cross_entropyloss_all/model_best.pth.tar&quot;</span>
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a>
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a>python3<span class="w"> </span>-W<span class="w"> </span>ignore<span class="w"> </span>./imagenet/t2c.py<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a><span class="w">    </span>--save_path<span class="w"> </span><span class="si">${</span><span class="nv">save_path</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a><span class="w">    </span>--model<span class="w"> </span><span class="si">${</span><span class="nv">model</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a><span class="w">    </span>--batch_size<span class="w"> </span><span class="si">${</span><span class="nv">batch_size</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a><span class="w">    </span>--resume<span class="w"> </span><span class="si">${</span><span class="nv">pre_trained</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a><span class="w">    </span>--log_file<span class="w"> </span><span class="si">${</span><span class="nv">log_file</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a><span class="w">    </span>--fine_tune<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a><span class="w">    </span>--wqtype<span class="w"> </span><span class="si">${</span><span class="nv">wqtype</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a><span class="w">    </span>--xqtype<span class="w"> </span><span class="si">${</span><span class="nv">xqtype</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a><span class="w">    </span>--wbit<span class="w"> </span><span class="si">${</span><span class="nv">wbit</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a><span class="w">    </span>--abit<span class="w"> </span><span class="si">${</span><span class="nv">abit</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a><span class="w">    </span>--dataset<span class="w"> </span><span class="si">${</span><span class="nv">dataset</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a><span class="w">    </span>--train_dir<span class="w"> </span><span class="s2">&quot;/share/seo/imagenet/train/&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a><span class="w">    </span>--val_dir<span class="w"> </span><span class="s2">&quot;/share/seo/imagenet/val/&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a><span class="w">    </span>--evaluate<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-6-39" name="__codelineno-6-39" href="#__codelineno-6-39"></a><span class="w">    </span>--trainer<span class="w"> </span>qattn<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-6-40" name="__codelineno-6-40" href="#__codelineno-6-40"></a><span class="w">    </span>--swl<span class="w"> </span><span class="m">32</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-6-41" name="__codelineno-6-41" href="#__codelineno-6-41"></a><span class="w">    </span>--sfl<span class="w"> </span><span class="m">26</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-6-42" name="__codelineno-6-42" href="#__codelineno-6-42"></a><span class="w">    </span>--export_samples<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
</code></pre></div>
<p><strong>Arguments:</strong></p>
<p>Similar to the PTQ script, the post-compression fusion and model export follows the similar configuration except a couple of changes and unique argument variables.</p>
<ul>
<li><code>save_path</code>: By default, the fused t2c model <code>t2c_model.pth.tar</code> and intermediate tensor files are saved in the <code>t2c/</code> folder under the path of PTQ directory. </li>
<li><code>swl</code>: Total bitwidth of the fused scaling factor (BatchNorm + Quantization). Default = 32bit.</li>
<li><code>sfl</code>: Fractional bitwidth of the fused scaling factor (BatchNorm + Quantization). Default = 26bit.</li>
<li><code>export_samples</code>: Batch size of the final export tensors. Default = 1. </li>
</ul>
<p>By executing the bash file, torch2chip will load the pre-trained fake quantized model and run through the fusion and export process. The converted model and the extracted tensors are saved in the <code>save_path</code> and <code>save_path/tensors/</code>, respectively. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>bash<span class="w"> </span>script/imagenet/vit-t2c-minmax-lsq.sh
</code></pre></div>
<h2 id="reload-your-torch2chip-model-back-for-verification">Reload your Torch2Chip model back for verification</h2>
<p>Now you have your T2C model (<code>t2c_model.pth.tar</code>) with integer-only operations. In practice, you might want to alter the low precision operations with some hardware-aware non-idealities. </p>
<p>To reload the t2c model from the previous example (<code>lsq + minmax_channel</code>), we provide the following example (<code>vit-t2c-reload-minmax-lsq.sh</code>) as a starting point: </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$DIRECTORY</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">    </span>mkdir<span class="w"> </span>./save
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="k">fi</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="nb">export</span><span class="w"> </span><span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="m">0</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="nv">model</span><span class="o">=</span>vit_small
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="nv">batch_size</span><span class="o">=</span><span class="m">100</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="nv">loss</span><span class="o">=</span>cross_entropy
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="nv">weight_decay</span><span class="o">=</span><span class="m">0</span>.0005
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="nv">dataset</span><span class="o">=</span><span class="s2">&quot;imagenet&quot;</span>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="nv">log_file</span><span class="o">=</span><span class="s2">&quot;reload.log&quot;</span>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="nv">wbit</span><span class="o">=</span><span class="m">8</span>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="nv">abit</span><span class="o">=</span><span class="m">8</span>
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="nv">xqtype</span><span class="o">=</span><span class="s2">&quot;lsq_token&quot;</span>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="nv">wqtype</span><span class="o">=</span><span class="s2">&quot;minmax_channel&quot;</span>
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="nv">ttype</span><span class="o">=</span>ptq
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a><span class="nv">save_path</span><span class="o">=</span><span class="s2">&quot;./save/imagenet/vit_small/lsq_token_minmax_channel/vit_small_w8_a8_lr1e-4_batch100_cross_entropyloss_all/t2c/&quot;</span>
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a><span class="nv">pre_trained</span><span class="o">=</span><span class="s2">&quot;./save/imagenet/vit_small/lsq_token_minmax_channel/vit_small_w8_a8_lr1e-4_batch100_cross_entropyloss_all/t2c/t2c_model.pth.tar&quot;</span>
<a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a>
<a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a>python3<span class="w"> </span>-W<span class="w"> </span>ignore<span class="w"> </span>./imagenet/reload.py<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a><span class="w">    </span>--save_path<span class="w"> </span><span class="si">${</span><span class="nv">save_path</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a><span class="w">    </span>--model<span class="w"> </span><span class="si">${</span><span class="nv">model</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a><span class="w">    </span>--batch_size<span class="w"> </span><span class="si">${</span><span class="nv">batch_size</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a><span class="w">    </span>--resume<span class="w"> </span><span class="si">${</span><span class="nv">pre_trained</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a><span class="w">    </span>--log_file<span class="w"> </span><span class="si">${</span><span class="nv">log_file</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a><span class="w">    </span>--fine_tune<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a><span class="w">    </span>--wqtype<span class="w"> </span><span class="si">${</span><span class="nv">wqtype</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a><span class="w">    </span>--xqtype<span class="w"> </span><span class="si">${</span><span class="nv">xqtype</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a><span class="w">    </span>--wbit<span class="w"> </span><span class="si">${</span><span class="nv">wbit</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a><span class="w">    </span>--abit<span class="w"> </span><span class="si">${</span><span class="nv">abit</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a><span class="w">    </span>--dataset<span class="w"> </span><span class="si">${</span><span class="nv">dataset</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a><span class="w">    </span>--train_dir<span class="w"> </span><span class="s2">&quot;/share/seo/imagenet/train/&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a><span class="w">    </span>--val_dir<span class="w"> </span><span class="s2">&quot;/share/seo/imagenet/val/&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a><span class="w">    </span>--evaluate<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a><span class="w">    </span>--trainer<span class="w"> </span>qattn<span class="w"> </span><span class="se">\</span>
</code></pre></div>
<p>As shown in the example of <code>imagenet/reload.py</code>, the model is reloaded to evaluate the accuracy based on the integer-only operation across the model. With that, users are allowed to customize the operator (e.g., Non-ideal MatMul) with hardware-oriented characteristics. </p>







  
  






                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/mengjian0502" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/jian-meng/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/contrib/auto-render.min.js"></script>
      
    
  </body>
</html>